{"version":3,"file":"moveable.esm.js","sources":["../src/InnerMoveable.tsx","../src/consts.ts","../src/MoveableManager.tsx","../src/Moveable.tsx","../src/utils.ts"],"sourcesContent":["import * as React from \"react\";\r\nimport Moveable from \"react-moveable\";\r\nimport { ref } from \"framework-utils\";\r\n\r\nexport default class InnerMoveable extends React.Component<any> {\r\n    public state: any = {};\r\n    public moveable!: Moveable;\r\n    constructor(props: any) {\r\n        super(props);\r\n        this.state = this.props;\r\n    }\r\n    public render(): React.ReactNode {\r\n        return <Moveable ref={ref(this, \"moveable\")} {...this.state} />;\r\n    }\r\n}\r\n","import {\r\n    MOVEABLE_PROPS,\r\n    MOVEABLE_METHODS,\r\n    MOVEABLE_EVENTS,\r\n} from \"react-moveable\";\r\n\r\nexport const PROPERTIES: string[] = MOVEABLE_PROPS;\r\nexport const METHODS: string[] = MOVEABLE_METHODS;\r\nexport const EVENTS: string[] = MOVEABLE_EVENTS;\r\n","import { ref, Properties } from \"framework-utils\";\r\nimport * as React from \"react\";\r\nimport { renderSelf, ContainerProvider } from \"croact\";\r\nimport InnerMoveable from \"./InnerMoveable\";\r\nimport {\r\n    MoveableInterface,\r\n    MoveableOptions, MoveableProperties,\r\n} from \"react-moveable/types\";\r\nimport { camelize, getDocument, isArray } from \"@daybrush/utils\";\r\nimport { MoveableEventsParameters } from \"./types\";\r\nimport { PROPERTIES, EVENTS, METHODS } from \"./consts\";\r\nimport EventEmitter from \"@scena/event-emitter\";\r\n/**\r\n * Moveable is Draggable! Resizable! Scalable! Rotatable!\r\n * @sort 1\r\n * @alias Moveable\r\n * @extends EventEmitter\r\n */\r\n@Properties(METHODS, (prototype, property) => {\r\n    if (prototype[property]) {\r\n        return;\r\n    }\r\n    prototype[property] = function(...args: any[]) {\r\n        const self = this.getMoveable();\r\n\r\n        if (!self || !self[property]) {\r\n            return;\r\n        }\r\n        return self[property](...args);\r\n    };\r\n})\r\n@Properties(PROPERTIES, (prototype, property) => {\r\n    Object.defineProperty(prototype, property, {\r\n        get() {\r\n            return this.getMoveable().props[property];\r\n        },\r\n        set(value) {\r\n            this.setState({\r\n                [property]: value,\r\n            });\r\n        },\r\n        enumerable: true,\r\n        configurable: true,\r\n    });\r\n})\r\nclass MoveableManager extends EventEmitter<MoveableEventsParameters> {\r\n    private innerMoveable!: InnerMoveable | null;\r\n    private containerProvider: ContainerProvider | null = null;\r\n    private selfElement: HTMLElement | null = null;\r\n    private _warp = false;\r\n    /**\r\n     *\r\n     */\r\n    constructor(parentElement: HTMLElement, options: MoveableOptions = {}) {\r\n        super();\r\n        const nextOptions = { ...options };\r\n\r\n        const events: any = {};\r\n\r\n        EVENTS.forEach(name => {\r\n            events[camelize(`on ${name}`)] = (e: any) => this.trigger<any>(name, e);\r\n        });\r\n        let selfElement!: HTMLElement;\r\n\r\n        if (options.warpSelf) {\r\n            delete options.warpSelf;\r\n            this._warp = true;\r\n            selfElement = parentElement;\r\n        } else {\r\n            selfElement = getDocument(parentElement).createElement(\"div\");\r\n            parentElement.appendChild(selfElement);\r\n        }\r\n        this.containerProvider = renderSelf(\r\n            <InnerMoveable\r\n                ref={ref(this, \"innerMoveable\")}\r\n                {...nextOptions}\r\n                {...events}\r\n            /> as any,\r\n            selfElement,\r\n        );\r\n\r\n        this.selfElement = selfElement;\r\n        const target = nextOptions.target!;\r\n        if (isArray(target) && target.length > 1) {\r\n            this.updateRect();\r\n        }\r\n    }\r\n    public setState(state: Partial<MoveableOptions>, callback?: () => any) {\r\n        this.innerMoveable!.setState(state, callback);\r\n    }\r\n    public forceUpdate(callback?: () => any) {\r\n        this.innerMoveable!.forceUpdate(callback);\r\n    }\r\n    public dragStart(e: MouseEvent | TouchEvent) {\r\n        const innerMoveable = this.innerMoveable;\r\n        if ((innerMoveable as any).$_timer) {\r\n            this.forceUpdate();\r\n        }\r\n        this.getMoveable().dragStart(e);\r\n    }\r\n    public destroy() {\r\n        const selfElement = this.selfElement!;\r\n\r\n        renderSelf(\r\n            null,\r\n            selfElement!,\r\n            this.containerProvider,\r\n        );\r\n        if (!this._warp) {\r\n            selfElement?.parentElement?.removeChild(selfElement);\r\n        }\r\n        this.containerProvider = null;\r\n\r\n        this.off();\r\n        this.selfElement = null;\r\n        this.innerMoveable = null;\r\n    }\r\n    private getMoveable() {\r\n        return this.innerMoveable!.moveable;\r\n    }\r\n}\r\n\r\ninterface MoveableManager extends MoveableInterface, MoveableProperties {\r\n}\r\n\r\nexport default MoveableManager;\r\n","import MoveableManager from \"./MoveableManager\";\r\n\r\nexport default class Moveable extends MoveableManager {}\r\n","import { Able, DefaultProps } from \"react-moveable/types\";\r\nimport { getElementInfo as getElementInfoFunction, makeAble as makeAbleFunction } from \"react-moveable\";\r\n\r\nexport function getElementInfo(\r\n    target: SVGElement | HTMLElement,\r\n    container?: SVGElement | HTMLElement | null,\r\n    rootContainer?: SVGElement | HTMLElement | null | undefined,\r\n) {\r\n    return getElementInfoFunction(target, container, rootContainer);\r\n};\r\nexport function makeAble<\r\n    Name extends string,\r\n    AbleObject extends Partial<Able<any, any>>,\r\n>(name: Name, able: AbleObject) {\r\n    return makeAbleFunction<Name, AbleObject>(name, able);\r\n}\r\n"],"names":["InnerMoveable","_super","__extends","props","_this","call","state","__proto","prototype","render","React","Moveable","__assign","ref","Component","PROPERTIES","MOVEABLE_PROPS","METHODS","MOVEABLE_METHODS","EVENTS","MOVEABLE_EVENTS","MoveableManager","parentElement","options","containerProvider","selfElement","_warp","nextOptions","events","forEach","name","camelize","concat","e","trigger","warpSelf","getDocument","createElement","appendChild","renderSelf","target","isArray","length","updateRect","setState","callback","innerMoveable","forceUpdate","dragStart","$_timer","getMoveable","destroy","_a","removeChild","off","moveable","__decorate","Properties","property","args","_i","arguments","self","Object","defineProperty","get","set","value","enumerable","configurable","EventEmitter","getElementInfo","container","rootContainer","getElementInfoFunction","makeAble","able","makeAbleFunction"],"mappings":"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"}